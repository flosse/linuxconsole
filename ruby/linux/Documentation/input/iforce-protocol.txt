** Introduction
This document describes what I managed to discover about the protocole used to specify force effects to I-Force 2.0 devices.
None of this information comes from Immerse. That's why you should not trust what is written in this document. This document is intended to help undertstanding the protocole.
This is not a reference. Comments and corrections are welcome. I made all these tests on my Boeder I-Force ForceFeedback Wheel. Please note I haven't made any test on joysticks.
To contact me, send email to: deneux@ifrance.com

** WARNING **
I may not be held responsible for any dammage or harm caused if you try to send data to your I-Force device based on what you read in this document.

** Preliminary Notes:
All values are hexadecimal with big-endian encoding (msb on the left). Beware, values inside packets are encoded using little-endian.
Bytes whose roles are unknown are marked ???
Information that needs deeper inspection is marked (?)

** Force effect **
OP=  01
LEN= 0e
00 Channel (when playing several effects at the same time, each must be assigned a channel)
01 Wave form
	Val 00 Constant
	Val 20 Square
	Val 21 Triangle
	Val 22 Sine
	Val 23 Sawtooth up
	Val 24 Sawtooth down
	Val 40 Spring (Force = f(pos))
	Val 41 Friction (Force = f(velocity)) and Inertia (Force = f(acceleration)) (Hum, I thought that accel = d(velocity)/dt...)

	
02 Axes affected and trigger
	Bits 4-7: Val 2 = effect along one axis. Byte 05 indicates direction
	          Val 4 = X axis only. Byte 05 must contain 5a
	          Val 8 = Y axis only. Byte 05 must contain b4
	          Val c = X and Y axes. Bytes 05 must contain 60
	Bits 0-3: Val 0 = No trigger
	          Val x+1 = Button x triggers the effect
	When the whole byte is 0, cancel the previously set trigger

03-04 Duration of effect (little endian encoding). 1s = 03e8

05 Direction of effect, if applicable. Else, see 02 for value to assign.

06-07 Minimum time between triggering.

08-09 Address of periodicity or magnitude parameters
0a-0b Address of attack and fade parameters, or ffff if none.
*or*
08-09 Address of interactive parameters for X-axis, or ffff if not
applicable
0a-0b Address of interactive parameters for Y-axis, or ffff if not
applicable

0c-0d Delay before execution of effect (little endian encoding). 1s = 03e8


** Time based parameters **

*** Attack and fade ***
OP=  02
LEN= 08
00-01 Address where to store the parameteres
02-03 Duration of attack (little endian encoding). 1s = 03e8
04 Level at end of attack. Signed byte.
05-06 Duration of fade.
07 Level at end of fade.

*** Magnitude ***
OP=  03
LEN= 03
00-01 Address
02 Level. Signed byte.

*** Periodicity ***
OP=  04
LEN= 07
00-01 Address
02 Magnitude. Signed byte.
03 Offset. Signed byte.
04 Phase. Val 00 = 0 deg, Val 40 = 90 degs.
05-06 Period (little endian encoding). 1s = 03e8

** Interactive parameters **

OP=  05
LEN= 0a
00-01 Address
02 Positive Coeff
03 Negative Coeff (Val 14 = 2000 (decimal))
04 Offset (Val 64 = 2000 (decimal)) | center ?
05 ??? Val = 00                     |
06+07 Dead band (Val 01F4 = 5000 (decimal))
08 Positive saturation (Val 0a = 1000 (decimal) Val 64 = 10000 (decimal))
09 Negative saturation

** Controls **
OP=  41
LEN= 03
00 Channel
01 Start/Stop
	Val 00: Stop
	Val 01: Start and play once.
	Val 41: Start and play n times (See byte 02 below)
02 Number of iterations n.

** Init **

*** Querying features ***
OP=  ff
Query command. Length varies according to the query type.
The general format of this packet is:
ff 01 QUERY CHECKSUM
reponses are of the same form:
FF LEN QUERY VALUE_QUERIED CHECKSUM2
where LEN = 1 + length(VALUE_QUERIED)

**** Query ram size ****
QUERY = 42 ('B'uffer size)
The driver should reply with the same packet plus two additionnal bytes
containing the size of the memory:
ff 03 42 03 e8 CS would mean that the device has 1000 bytes of ram available.

**** Query number of effects ****
QUERY = 4e ('N'umber of effects)
The driver should respond by sending the number of effects that can be played
at the same time (one byte)
ff 02 4e 14 CS would stand for 20 effects.

**** Vendor's id ****
QUERY = 4d ('M'anufacturer)
Query the vendors'id (2 bytes)

**** Product id *****
QUERY = 50 ('P'roduct)
Query the product id (2 bytes)

**** Other features ****
QUERY = 43 ('C') - sends back 'C' and 0 bytes
QUERY = 45 ('E') - sends back 2 bytes (00 00 or 00 01)
QUERY = 4f ('O') - sends back 'O' and 0 bytes
QUERY = 56 ('V'ersion) - sends back 3 bytes (02 03 00 or 02 04 00 or 02 05 00)

*** Initialisation of the device ***

**** Setting a default spring ****
OP=  40
LEN= 2 or 3
00 Command type:
   Val 03 Set the strength of the spring
   Val 04 Enable or disable the spring 
01 Strength of the spring if 00 = Val 03
   Enable (Val 01) or disable (00) the default spring if 00 = Val 04
02 ???

**** ???? ****
OP=  42
LEN= 1
00 FF enable/disable?
   Val 01 Disables force feedback
   Val 04 Enables force feedback
   Val 05 Enables force feedback

**** Setting overall gain ****
OP=  43
LEN= 1
00 Gain
   Val 00 = 0%
   Val 40 = 50%
   Val 80 = 100%

** Parameters' memory **

Each device has a certain amount of memory to store parameters of effects.
The amount of RAM may vary, I encountered values from 200 to 1000 bytes. Below
is the amount of memory apparently needed for every set of parameters:
 - period : 0c
 - magnitude : 02
 - attack and fade : 0e
 - interactive : 08

** Appendix: How to study the protocol ? **

1. Generate effects using the force editor provided with the DirectX SDK, or use Immersion Studio (freely available at their web site in the developer section: www.immersion.com)
2. Start a soft spying RS232 or USB (depending on where you connected your joystick/wheel). I used ComPortSpy from fCoder (alpha version!)
3. Play the effect, and watch what happens on the spy screen.

A few words about ComPortSpy:
At first glance, this soft seems, hum, well... buggy. In fact, data appear with a few seconds latency. Personnaly, I restart it every time I play an effect.
Remember it's free (as in free beer) and alpha!

** URLS **
Well, I don't have them at hand (unluckyly, I do not have internet at home).
Check www.immerse.com for Immersion Studio, and www.fcoder.com for ComPortSpy.

** Author of this document **
Johann Deneux <deneux@ifrance.com>
Home page at http://www.esil.univ-mrs.fr/~jdeneux/projects/ff/


I-Force is trademark of Immersion Corp.
